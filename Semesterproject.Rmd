---
title: Check how to Schreck
subtitle: Semester Project of the module PTED FS 22
author: Fabienne Gräppi and Benjamin Bar-Gera
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
---


<!-- You can add  your R Code with Code chunks-->

```{r, echo = FALSE, warning=FALSE, message=FALSE}

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo = FALSE           hides the code from the generated output
# warning = FALSE        hides warnings from the generated output
# message = FALSE        hides messages from the generated output

# To set the setting for all code chunks, use the following code:

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

```

# Abstract

As part of a previous study, a number of wildboar scare off elements have been employed throughout the Fanel region at the western end of Lake Neuchâtel. The point of these acoustic elements is to scare off the animals so that they disperse and create less damage to the agricultural crops around the scare off elements. As a result of this previous study, we have access to a data set which includes the type and agenda for the scare off elements, as well as the GPS points for a number of wild boars that were living in this area throughout the period when the scare off elements were employed. Using exploratory and confirmatory data analysis methods, we tried to discern whether these scare off elements have any effect on the spatial distribution of the animals, and if so, what settings are the most effective at dispersing the animals. However, based on our analysis the effect of the scare off elements was insignificant at scarring away the animals, and sometimes even seemed to have an attractive effect on them. As such, there was no reason to generate models which can tell us which settings are the most effective at scaring away the wild boar individuals, if the scare offs have no effect in the first. Nevertheless, we still had a look at the data table which shows which settings were employed when to understand if we might have overlooked something. All in all, this exercise allowed us to employ the various concepts and tools which we learned throughout the module Patterns and Trends in Environmental Data.


# Introduction

Since almost going extinct in some parts of Europe the population of wild boars (*Sus scrofa*) has increased strongly ^1,2^, and they are now the fifth largest ungulated species in Europe ^3,4^. The increase of population in Europe has had significant influence on the biodiversity in forests and an economic impact on cultivated areas due to damage in crop fields and transmission of diseases on domestic animals ^3^. In Switzerland the damages from wild boars to cultivated areas cumulate to several million CHF a year ^5^. In order to reduce damage from wild boars in Switzerland, the Federal Environmental Agency (Bundesamt für Umwelt/BAFU) has released a document with tips and guidelines for the regulation of wild boar management and damage prevention. Measures described in the guideline include population control through hunting, employment of damage reducing actions, such as the use of electrical fences around cultivated areas or dissuasive feeding and the appropriate reimbursement for damages ^2,6,7^. Hunting to reduce population might be the most effective way to reduce damages but it can also have a negative impact on the living environment of other animals or plants and is highly time as well as work intensive ^4,6,7^. Other measures such as electrical fencing are sometimes also time intensive and costly to install. However, adequate defense measures are needed in the future as with population growth and the increasing distribution of wild boars, the pressure on agricultural land will continue to increase.  Due to the drawbacks of the described measures cheaper and less time and work consuming instruments have been tested such as acoustic scare offs (also known as 'schrecks') ^1^. Wild boars have a keen sense of hearing and communicate with each other with warning sounds when they sense danger ^8^. This characteristic can be exploited to keep wild boars away from agricultural land by means of an acoustic scare device. This involves playing wild boar warning sounds or other sounds that signify danger at intervals.

Previous studies at the Department WILMA (Wildtiermanagement) at the ZHAW have demonstrated a reduction in damage to agricultural crops. In addition, the effectiveness of acoustic wild boar scare offs should now be analyzed with this study, in terms of their influence on the spatial behavior of wild boars.

# Aim of the Study and Research Questions 

This present study is developed within the module Patterns and Trends in Environmental Data (PTED 22). The effectiveness of the acoustic wild boar scare off systems is to be investigated on the basis of the spatial behavior of wild boars. In the course of this, GPS location data of wild boars with different sampling intervals over a period of about 2 years and data sets of scare off locations and agenda were provided. The area of interest in this study is the Fanel region at the western end of Lake Neuchâtel.

The aims of this study are to answer the following research questions:

- Q1: How effective are the Wildschwein-Schreck (WS) at keeping away wild boar and how long do these effects last?
- Q2: What settings (mode, noise level, interval, azimuth) and setting-combintations are most effective at keeping away wild boar?

# Material and Methods
## Data and Packages

Following R-Packages were used for the data processing and analysis:

- ComputationalMovementAnalysisData
- tidyverse
- sf
- leaflet
- leaflet.extras2
- gganimate
- ggspatial
- cowplot
- knitr
- multcompView
- pander

```{r}
library(tidyverse)
library(ComputationalMovementAnalysisData)
library(sf)
library(leaflet)
library(leaflet.extras2)
library(gganimate)
library(ggspatial)
library(cowplot)
library(knitr)
library(multcompView)
library(pander)
```

Data used for this project was provided from our module supervisors. We used a dataset of wild boar GPS locations with time stamps (*Table 1*; wildschwein_BE), a set with the locations of the scare off (schreck) devices (*Table 2*; schreck_location) and a third set including the data when the scare off devices were on/off with additional information about their parameter settings. (*Table 3*; schreck_agenda). The wild boar location was sampled at 15 min intervals. While for the scare off events we know when they were turned on and off but have no further, more precise time information (in regards to their intervals). The individual scare off settings can be adjusted for two different modes (standard v1 and aggressive v2), volume (a range of 33 - 100), interval (12.5 - 30), max. and min. orientation (0-330). We have access to all of that data as well.
For our data analysis we assumed the wild boar location data to be non-constrained in a continuous Euclidian space, as described in Laube (2017) ^9^. Meaning, we assume no boundaries or barriers for the wild boars to reach the agricultural field and the observed area around the scare off. Data sampling was performed with GPS point collectors, therefore data analysis is in a Lagrangian perspectiv ^10^.

```{r}
kable(head(wildschwein_BE), caption = "Table 1: Wild boar location data")
kable(head(schreck_locations), caption = "Table 2: Scare off location data")
kable(head(schreck_agenda), caption = "Table 3: Scare off on/off, interval and parameter data")
```

## Data Preprocessing and Tools

Both the wildboar and the scare off data was filtered. The data was filtered for the relevant areas and time periods. As a first step, only wild boar location data within the closer proximity of the scare off locations was considered. Therefore, the data frames were transformed to sf objects and visually investigated (*Figure 1*) as well as cropped to the relevant area (*Figure 2*).

```{r, fig.cap = "Figure 1: Wild boar locations (blue) and scare off locations (red) uncropped"}
# Convert data to sf formats
schreck_locations_sf <- st_as_sf(schreck_locations,
                                 coords = c("lon", "lat"),
                                 crs = 4326)
wildschwein_BE_sf <- st_as_sf(wildschwein_BE,
                                 coords = c("E", "N"),
                                 crs = 2056)
# Convert schreck_locations_sf from crs 4326 (WGS84) to crs 2056 (CH1903+ / LV95)
schreck_locations_sf <- st_transform(schreck_locations_sf, crs = 2056)

# Visualize the data (schreck and wildschwein locations)
ggplot() +
  geom_sf(data = wildschwein_BE_sf, colour = "blue") +
  geom_sf(data = schreck_locations_sf, colour = "red", alpha = 0.5) +
  annotation_scale() +
  coord_sf(datum=st_crs(2056))

# Crop both sf data frames (wildschwein & scare off locations) to only show area with significant overlap

wildschwein_BE_sf_cropped <- st_crop(wildschwein_BE_sf, xmin = 2560000, xmax = 2580000, ymin = 1200000, ymax = 1220000)
schreck_locations_sf_cropped <- st_crop(schreck_locations_sf, xmin = 2560000, xmax = 2580000, ymin = 1200000, ymax = 1220000)
```

```{r, fig.cap = "Figure 2: Wild boar locations (blue) and scare off locations (red) cropped"}
ggplot() +
  geom_sf(data = wildschwein_BE_sf_cropped, colour = "blue") +
  geom_sf(data = schreck_locations_sf_cropped, colour = "red", alpha = 0.5) +
  annotation_scale() +
  coord_sf(datum=st_crs(2056))
```

Secondly, the two data frames for the scare off locations and the scare off agenda were joined to a single data frame and afterwards filtered according to the time when wild boar data was available. After filtering, 7 relevant scare off events and locations remained. Those are listed in *Table 4*.

```{r}
# First step: Join the schreck locations with the schreck events
schreck_agenda_and_locations <- schreck_locations_sf_cropped %>%
  left_join(schreck_agenda, by = "id")

# Filter Schreck-Agenda to the times when we have Wildschwein Data
schreck_agenda_and_locations_filtered <- schreck_agenda_and_locations %>%
  filter(
    datum_on > min(wildschwein_BE_sf_cropped$DatetimeUTC),
    datum_off < max(wildschwein_BE_sf_cropped$DatetimeUTC)
  )

# We do this to merge the two events each for WSS_2015_01, WSS_2015_03, WSS_2015_04...
schreck_agenda_and_locations_merged <- schreck_agenda_and_locations_filtered %>%
  group_by(id) %>%
  summarise(
    datum_on = min(datum_on),
    datum_off = max(datum_off)
  )
kable(schreck_agenda_and_locations_merged, caption= "Table 4: Scare offs active within wild boar sampling period")
```

In order to be able to rule out the possibility that the scare off events somehow interacted with each other, we examined the physical and temporal distances between the scare off events and locations, as shown in *Figure 3*. Although scare off 2015_04 and 2016_06 are very close to each other (within a few meters), they were active in different years. Therefore, we assumed there is no mutual influence in terms of wild boar scare off.

```{r, fig.cap = "Figure 3: Scare off location overlap"}
# Show how the circles lie over each other to determine whether to combine some Schreck-Locations
schreck_agenda_and_locations_merged_cricles <- st_buffer(schreck_agenda_and_locations_merged, 250)

ggplot() +
  geom_sf(data = schreck_agenda_and_locations_merged_cricles) +
  geom_sf(
    data = schreck_agenda_and_locations_merged, 
    mapping = aes(color = paste(id, "|", "on:", datum_on, "|", "off:", datum_off))
    ) +
  annotation_scale() +
  coord_sf(datum=st_crs(2056)) +
  labs(color = 'Scare Off ID | Date On | Date Off', title = "Radius: 250 m")
```

Additionally, for the statistical approaches we had to neglect two scare offs. WSS_2016_06 provides only 11 GPS points within a scare off duration of 30 days (with 10 days before and 14 days after the scare off event and a buffer zone with a radius of 500 m around the scare off location) and WSS_2016_13 was active only for 5 days which is not comparable to the other scare off events.

```{r}
# Create function that can automatically draw a denstiy plot for a specific schreck location 
# & specify number of days before and after schreck event that should appear on plot
# & specify the radii around schreck location
draw_density_plot <- function(schreck_id, radii, days_before, days_after) {
  # Filter schreck agenda to specific schreck
  specific_schreck <- schreck_agenda_and_locations_merged %>%
    filter(id == schreck_id)
  
  # Filter all wildschwein points by date to only ones occuring within above-mentioned schreck event (7 days before, during and 21 days after)
  specific_schreck_wildschwein <- wildschwein_BE_sf_cropped %>%
    filter(
      DatetimeUTC > as.Date(specific_schreck$datum_on) - days_before,
      DatetimeUTC < as.Date(specific_schreck$datum_off) + days_after
    )
  
  # For each radius (x) in radii... (this creates a vector with one SF data frame per radius in radii)
  schreck_specific_wildschwein_points <- radii %>% map(
    .f = function(x){
      # ... Create a circle / buffer with radius x around schreck 
      circle <- st_buffer(specific_schreck, x)
      # ... Filter all date-relevant wildschwin points to the ones in circle with radius x
      pigs_in_circle <- st_filter(specific_schreck_wildschwein, circle)
      # ... Add some convenience variables (radius and date) in order to visualize the density plots
      pigs_in_circle <- pigs_in_circle %>%
        mutate(
          radius = as.factor(x),
          date = as.Date(DatetimeUTC)
        )
      # ... return SF Data frame with the relevant pigs for radius x
      return(pigs_in_circle)
    }
  )
    # Combine all the SF data frames in schreck_specific_wildschwein_points to a singular data frame with variable 'radius'
  combined_wildschwein_points <- bind_rows(schreck_specific_wildschwein_points)
  
  
  # Plot the number of wildschwein per day within each schreck buffer for the specified dates
  combined_wildschwein_points %>%
    ggplot() +
    geom_density(mapping = aes(x = date, color = radius)) +
    # Then add 2 lines to signify start and end off schreck event
    geom_vline(xintercept =  as.Date(specific_schreck$datum_on), linetype="dotted", color = "blue", size = 1.5) +
    geom_vline(xintercept =  as.Date(specific_schreck$datum_off), linetype="dotted", color = "blue", size = 1.5) +
    labs(
      title = schreck_id, 
      subtitle = paste(
        "GPS Points:", nrow(combined_wildschwein_points),
        "|",
        "Duration:", (difftime(as.Date(specific_schreck$datum_off), as.Date(specific_schreck$datum_on), units = "days")),
        "days"
      )
    )
}
```

```{r, fig.cap = "Figure 4: Density plots of scare offs active during wild boar location sampling with duration and number of GPS point"}
WSS_2015_01_plot <- draw_density_plot("WSS_2015_01", c(500), 10, 14)

WSS_2015_03_plot <- draw_density_plot("WSS_2015_03", c(500), 10, 14)

WSS_2015_04_plot <- draw_density_plot("WSS_2015_04", c(500), 10, 14)

WSS_2016_01_plot <- draw_density_plot("WSS_2016_01", c(500), 10, 14)

WSS_2016_05_plot <- draw_density_plot("WSS_2016_05", c(500), 10, 14)

WSS_2016_06_plot <- draw_density_plot("WSS_2016_06", c(500), 10, 14)

WSS_2016_13_plot <- draw_density_plot("WSS_2016_13", c(500), 10, 14)

plot_grid(WSS_2015_01_plot, WSS_2015_03_plot, WSS_2015_04_plot, WSS_2016_01_plot, WSS_2016_05_plot, WSS_2016_06_plot, WSS_2016_13_plot, ncol = 2)
```

## Functions 
### Density Plots Function

To get an impression if the scare offs influences the occurrence of wild boars and how is the range of the effect, we designed a function. The function `draw_density_plot(schreck_id, radii, days_before, days_after)` is used to filter the data by observation radius and time for one scare off to then plot it as a density function. Thereby, the time period of days before and after the event can be set, while the time period during the event is given by the scare off agenda.

```{r}
# Unlike for the other functions, you will find the code for the draw_density_plot(schreck_id, radii, days_before, days_after) function in the chunk above, otherwise we would not have been able to display the plots in the previous section
```

### Interactive Map Function

To visually explore how an active scare off affects the spatial distribution of wild boars, we wrote a function `generate_interactive_map(schreck_id, radius, days_before, days_after)`. The function takes as parameters a specific scare off, the radius of the buffer zone, as well as the number of days before and after the scare off event which should also be included. The function generates an interactive leaflet map which allows the user to swipe through time (from before until after the scare off event) and see the GPS points of the wild boars which occurred within the predefined buffer zone throughout this time period.

```{r}
generate_interactive_map <- function(schreck_id, radius, days_before, days_after) {
  
  specific_schreck <- schreck_agenda_and_locations_merged %>%
    # Filter schreck agenda to specific schreck
    filter(id == schreck_id)
  
  # Draw a circle around that schreck
  specific_schreck_circle <- st_buffer(specific_schreck, dist = radius)
  
  specific_schreck_wildschwein <- wildschwein_BE_sf_cropped %>%
    # Filter wildschwein points by date to only ones occuring within above-mentioned schreck event
    filter(
      DatetimeUTC > as.Date(specific_schreck$datum_on) - days_before,
      DatetimeUTC < as.Date(specific_schreck$datum_off) + days_after
    ) %>%
    # Filter the above-mentioned wildschwein points to ones within the schreck circle
    st_filter(specific_schreck_circle) %>%
    # Create a new convenience variable (date, without time) 
    mutate(
      date = as.Date(DatetimeUTC)
    )
  
  # Convert back to lon/lat format (WGS83), otherwise leaflet doesn't work
  specific_schreck <- st_transform(specific_schreck, crs = 4326)
  specific_schreck_wildschwein <- st_transform(specific_schreck_wildschwein, crs = 4326)
  
  bbox <- st_bbox(specific_schreck) %>%
    as.vector()
  
  p <- leaflet(data = specific_schreck) %>%
    addTiles() %>%
    addCircleMarkers(
      color = "red"
    ) %>%
    addTimeslider(data = specific_schreck_wildschwein,
                  options = timesliderOptions(
                    position = "topright",
                    timeAttribute = "DatetimeUTC",
                    sameDate = TRUE,
                    alwaysShowDate = TRUE)) %>%
    setView(bbox[1], bbox[2], zoom = 15)
  
  return(p)
}
```

### Static Map (All Invidiauls) Function

As an alternative to the interactive map function, we also wrote a function called `generate_static_maps(schreck_id, radius, days_before, days_after)`. The function takes a specific scare off, a predefined buffer zone radius, and the number of days before and after the scare off event are over to be included. The function generates three maps, each one showing all data points within a period in relation to the scare off event (before, during, and after the scare off). Only data points that fall within this time period (days before scare off event until days after scare off event) and within the buffer zone are considered. The maps also differentiate between the individuals by providing them with different colors.

```{r}
  generate_static_maps <- function(schreck_id, radius, days_before, days_after) {
    specific_schreck <- schreck_agenda_and_locations_merged %>%
      # Filter schreck agenda to specific schreck
      filter(id == schreck_id)
    
    # Draw a circle around that schreck
    specific_schreck_circle <- st_buffer(specific_schreck, dist = radius)
    
    specific_schreck_wildschwein <- wildschwein_BE_sf_cropped %>%
      # Filter wildschwein points by date to only ones occuring within above-mentioned schreck event
      filter(
        DatetimeUTC > as.Date(specific_schreck$datum_on) - days_before,
        DatetimeUTC < as.Date(specific_schreck$datum_off) + days_after
      ) %>%
      # Filter the above-mentioned wildschwein points to ones within the schreck circle
      st_filter(specific_schreck_circle) %>%
      # Create a new convenience variable (date, without time) 
      mutate(
        date = as.Date(DatetimeUTC),
        period = 
          ifelse(DatetimeUTC < specific_schreck_circle$datum_on, "BEFORE", 
                 ifelse(DatetimeUTC > specific_schreck_circle$datum_off, "AFTER", 
                        "DURING")),
        period = factor(period, levels = c("BEFORE", "DURING", "AFTER"))
      )
    
    p <- ggplot() +
      geom_sf(data = specific_schreck_wildschwein, mapping = aes(color = as.factor(TierName))) +
      geom_sf(data = specific_schreck, shape = 22, size = 3, mapping = aes(fill = "Scare Off Location")) +
      facet_grid(~ period) +
      theme(legend.position = "bottom") +
      scale_fill_manual("", breaks = "Scare Off Location", values = "red") +
      guides(color = guide_legend(title = "Individual name")) +
      coord_sf(datum=st_crs(2056)) + 
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
    
    return(p)
  }
```

### Static Map (One Invidiaul) Function

In addition to the interactive map function, we wrote a function called `generate_static_map_individual_wild_boar(schreck_id, radius, days_before, days_after, tier_id)`. The function takes a specific scare off, a predefined buffer zone radius, the number of days before and after the scare off event are over to be included, as well as the ID of a specific individual wild boar. The function generates one map which shows all of that individual's GPS points during this time period (days before scare off event until days after scare off event), even outside of the defined buffer zone. The map also shows the buffer zone (orange circle), the scare off location and uses color to differentiate between the GPS points which happened before, during, and after the scare off event.

To decide which individual to focus on we wrote the function `generate_data_points_table(schreck_id, radius, days_before, days_after)`, which shows us for a specific scare off location and event, which individual has the most GPS points within that time period and buffer zone.

```{r}
# Function to see how many data points per individual are available
generate_data_points_table <- function(schreck_id, radius, days_before, days_after) {
    specific_schreck <- schreck_agenda_and_locations_merged %>%
      # Filter schreck agenda to specific schreck
      filter(id == schreck_id)
    
    # Draw a circle around that schreck
    specific_schreck_circle <- st_buffer(specific_schreck, dist = radius)
    
    specific_schreck_wildschwein <- wildschwein_BE_sf_cropped %>%
      # Filter wildschwein points by date to only ones occuring within above-mentioned schreck event
      filter(
        DatetimeUTC > as.Date(specific_schreck$datum_on) - days_before,
        DatetimeUTC < as.Date(specific_schreck$datum_off) + days_after
      ) %>%
      # Create a new convenience variable (date, without time) 
      mutate(
        date = as.Date(DatetimeUTC),
        period = 
          ifelse(DatetimeUTC < specific_schreck_circle$datum_on, "BEFORE", 
                 ifelse(DatetimeUTC > specific_schreck_circle$datum_off, "AFTER", 
                        "DURING")),
        period = factor(period, levels = c("BEFORE", "DURING", "AFTER"))
      )
    
    points_per_individual <- specific_schreck_wildschwein %>%
      group_by(TierID, TierName) %>%
      summarise(
        total = n()
      ) %>%
      arrange(desc(total)) %>%
      st_drop_geometry()
    
    return(points_per_individual)
  }
```

```{r}
# Function to generate static map for single individual wild boar
  generate_static_map_individual_wild_boar <- function(schreck_id, radius, days_before, days_after, tier_id) {
    specific_schreck <- schreck_agenda_and_locations_merged %>%
      # Filter schreck agenda to specific schreck
      filter(id == schreck_id)
    
    # Draw a circle around that schreck
    specific_schreck_circle <- st_buffer(specific_schreck, dist = radius)
    
    specific_schreck_wildschwein <- wildschwein_BE_sf_cropped %>%
      # Filter wildschwein points by date to only ones occuring within above-mentioned schreck event
      filter(
        DatetimeUTC > as.Date(specific_schreck$datum_on) - days_before,
        DatetimeUTC < as.Date(specific_schreck$datum_off) + days_after
      ) %>%
      # Create a new convenience variable (date, without time) 
      mutate(
        date = as.Date(DatetimeUTC),
        period = 
          ifelse(DatetimeUTC < specific_schreck_circle$datum_on, "BEFORE", 
                 ifelse(DatetimeUTC > specific_schreck_circle$datum_off, "AFTER", 
                        "DURING")),
        period = factor(period, levels = c("BEFORE", "DURING", "AFTER"))
      )
    
    specific_schreck_wildschwein_single_individual <- specific_schreck_wildschwein %>%
      filter(
        TierID == tier_id
      )
    
    plot <- ggplot(specific_schreck_wildschwein_single_individual) +
      geom_sf() +
      geom_path(stat = "sf_coordinates", mapping = aes(geometry = geometry)) +
      geom_point(stat = "sf_coordinates", mapping = aes(geometry = geometry, color = period)) +
      geom_sf(data = specific_schreck, shape = 22, size = 3, mapping = aes(fill = "Scare Off Location")) +
      geom_sf(data = specific_schreck_circle, fill = NA, color = "orange") +
      scale_fill_manual("", breaks = "Scare Off Location", values = "red") +
      coord_sf(datum=st_crs(2056))
    
    return(plot)
  }
```

### ANOVA/Boxplot Function

In order to statistically and visually confirm whether a scare off event has an effect on the distribution of wild boars in its vicinity, we wrote the function `anova_for_schreck(schreck_id, radius)`. The function takes as input parameters a specific scare off and a radius for its buffer zone. The function then generates an ANOVA for the number of GPS points **per day** within that buffer zone for the period before, during, and after the scare off event. The function then runs a post-hoc tukey test to and applies the labels from this test to a boxplot, allowing the user to easily see whether significant (p < 0.05) differences between these groups (before, during, after) exist.

```{r}
  # Extract labels and factor levels from Tukey post-hoc 
  generate_label_df <- function(tukey, variable){
    Tukey.levels <- tukey[[variable]][,4]
    Tukey.labels <- data.frame(multcompLetters(Tukey.levels)['Letters'])
    Tukey.labels[[variable]] = rownames(Tukey.labels)
    Tukey.labels = Tukey.labels[order(Tukey.labels[[variable]]) , ]
    return(Tukey.labels)
  }

  # Function which generates model, anova, post-hoc tukey test and a boxplot for specified schreck and radius
  anova_for_schreck <- function(schreck_id, radius) {
    
    # Filter schreck agenda to specific schreck
    specific_schreck <- schreck_agenda_and_locations_merged %>%
        filter(id == schreck_id)
    
    # Create buffer zone with radius around specific schreck
    specific_schreck_circle <- st_buffer(specific_schreck, dist = radius)
    
    # Filter out only the wild boar within the buffer zone
    wildschwein_in_circle <- wildschwein_BE_sf_cropped %>%
      st_filter(specific_schreck_circle) %>%
      mutate(
        date = as.Date(DatetimeUTC),
        period = 
          ifelse(DatetimeUTC < specific_schreck_circle$datum_on, "BEFORE", 
                 ifelse(DatetimeUTC > specific_schreck_circle$datum_off, "AFTER", 
                        "DURING")))
    
    # Group the gps points by day
    wildschwein_per_day <- wildschwein_in_circle %>%
      st_drop_geometry() %>%
      group_by(date, period) %>%
      summarise(
        total_per_day = n()
      )
    
    # Estimate the effect of the period on the number of WS GPS Points per day:
    anova <- aov(total_per_day ~ period, data = wildschwein_per_day)
    
    # Tukey test to study each pair of period:
    tukey <- TukeyHSD(x = anova)
    
    # Apply the function to the dataset
    labels <- generate_label_df(tukey , "period")
    
    wildschwein_per_day <- wildschwein_per_day %>%
      left_join(labels, by = "period")
    
    wildschwein_per_day <- wildschwein_per_day %>%
      mutate(
        period = factor(period, levels = c("BEFORE", "DURING", "AFTER")) 
      )
    
    gg_labels <- wildschwein_per_day %>%
      group_by(period, Letters) %>%
      summarise(
        height = max(total_per_day)
      )
    
    p <- wildschwein_per_day %>%
      ggplot() +
      geom_boxplot(mapping = aes(x = period, y = total_per_day)) +
      ylim(NA, 1.1 * max(wildschwein_per_day$total_per_day)) +
      labs(
        x = "Period in relation to Schreck Event",
        y = "# of GPS points within buffer zone per day"
      ) + 
      geom_text(data = gg_labels,
                aes(x = period, y = height, label = Letters),
                vjust = -1.5, hjust = "inward")
    
    returnedList <- list("anova" = anova, "wildschwein_per_day" = wildschwein_per_day, "plot" = p)
    
  }
```

# Results
## Effect of Scare Off on Total Wild Boar Occurance (Q1)
### Exploratory Analysis
#### Density Plots

The wild boar density shows different patterns for each scare off event (*Figure 5*). The number of GPS points for each event ranges from 178 (WSS_2016_05) to over 10'000 points (WSS_2015_01). For WSS_2015_01, WSS_2015_03, and  WSS_2015_04 we observe the contrary pattern of what we expected, the occurrence increases during the first half of the event and then begins to decrease. The occurrence change is very similar when considering 100 m, 200 m or 400 m radius. However the amplitude decreases with larger radius. WSS_2016_01 and WSS_2016_05 follow more the expected pattern, but the difference of the number of GPS points is high. For those scare off we observe higher amplitudes for smaller radius. While for WSS_2016_05 the size of the radius has low impact on the observation, it has a great impact for WSS_2016_01 observation.

```{r, fig.cap = "Figure 5: Density plots for each scare off event, 10 days before and 14 days after event"}
WSS_2015_01_plot <- draw_density_plot("WSS_2015_01", c(100, 200, 400), 10, 14)

WSS_2015_03_plot <- draw_density_plot("WSS_2015_03", c(100, 200, 400), 10, 14)

WSS_2015_04_plot <- draw_density_plot("WSS_2015_04", c(100, 200, 400), 10, 14)

WSS_2016_01_plot <- draw_density_plot("WSS_2016_01", c(100, 200, 400), 10, 14)

WSS_2016_05_plot <- draw_density_plot("WSS_2016_05", c(100, 200, 400), 10, 14)

WSS_2016_06_plot <- draw_density_plot("WSS_2016_06", c(100, 200, 400), 10, 14)

WSS_2016_13_plot <- draw_density_plot("WSS_2016_13", c(100, 200, 400), 10, 14)

plot_grid(WSS_2015_01_plot, WSS_2015_03_plot, WSS_2015_04_plot, WSS_2016_01_plot, WSS_2016_05_plot, nrow = 3)
```

#### Interactive Maps

In a further step of exploratory data analysis, we created interactive maps for two scare off events: one with the expected results (*Figure 6*; WSS_2016_01) and on with the opposite results (*Figure 7*; Wss_2015_01) for visual comparison.

```{r, fig.cap = "Figure 6: Wild boar location of WSS_2015_01 scare off, 10 days before, during, and 14 days after event. The red dot shows the scare off location, the blue dots are wild board GPS locations. Only WGS84 possible."}
# The reason why we imported the leaflet widgets as html files, instead of running the code in the markdown file has do to with the fact that the leaflet timeslider seems to fail when we present more than 1 interactive map. Nevertheless, we included the function generate_interactive_map(schreck_id, radius, days_before, days_after) in the methods section.
knitr::include_url("p_WSS_2015_01.html")
```

```{r, fig.cap = "Figure 7: Wild boar location of WSS_2016_01 scare off, 10 days before, during, and 14 days after event.  The red dot shows the scare off location, the blue dots are wild board GPS locations. Only WGS84 possible."}
knitr::include_url("p_WSS_2016_01.html")
```

#### Static Maps
##### All Individuals

In addition to the interactive maps, we also generated various static maps that allow us to visualize the spatial distribution of the wild boar in relation to the scare off event and location. *Figure 8* shows the locations of the four individuals, Caroline, Claude, Olga, and Sabine, that were within a 200 m radius of the scare off event WSS_2015_01, 10 days before, during, and 10 days after the event. Caroline and Olga do not seem to be kept away from the scare off, but rather even attracted to it. Also Sabine shows only in the 200 m radius as the scare off is on and remains also afterwards still in the proximity. Only Claude moves away during the scare off event and is no longer within the 200 m radius 10 days after the event.

```{r, fig.cap = "Figure 8: Static map (before, during, after), of WSS_2015_01, radius = 200 m, 10 days before until 10 days after scare off event"}

WSS_2015_01_static_map <- generate_static_maps("WSS_2015_01", 200, 10, 10)
WSS_2015_01_static_map

```

At the scare off event/location WSS_2016_01 the individuals Caroline, Frida and Miriam are situated in the observed zone (*Figure 9*). Caroline disappears during the fright event and also Frida moves away from the 200 m radius afterwards. Miriam, however, remains in the vicinity of the scare off location.

```{r, fig.cap = "Figure 9: Static map (before, during, after) of WSS_2016_01, radius = 200 m, 10 days before until 10 days after scare off event"}

WSS_2016_01_static_map <- generate_static_maps("WSS_2016_01", 200, 10, 10)
WSS_2016_01_static_map

```

##### One Individual

For a more detailed perspective, we wanted to  visualize all GPS points of a single individual in relation to a scare off event and location to decide which individual to focus on, we first selected the scare off location with the highest number of GPS points within its buffer zone over time (see *Figure 5: Density Plots* above). The buffer zone around scare off WSS_2015_01 includes the highest total number of GPS points (10'656). 

We then generated a table (*Table 5*) to see how many points belong to each individual within that buffer zone and time period (10 days before until 10 days after the scare off event). We then chose to visualize the movements of the individual with the highest number of points, Sabine. 

```{r}
  number_of_points_per_individual <- generate_data_points_table("WSS_2015_01", 200, 10, 10)
  kable(number_of_points_per_individual, caption = "Table 5: Sum of GPS data points of each wildboar within 200 m radius of scare off 10 days before, during, and 10 day after event")
```

As a result, we generated *Figure 10*, which shows all of Sabine's data points from 10 days before until 10 days after the scare off events, outside and inside the buffer zone (r = 200 m, orange) around scare off WSS_2015_01.

```{r, fig.cap = "Figure 10: Static map of Sabine's spatial expansion 10 days before, during, and 10 after scare off event of WSS_2015_01"}
  WSS_2015_01_individual <- generate_static_map_individual_wild_boar("WSS_2015_01", 200, 10, 10, 2)
  WSS_2015_01_individual
```

With regard to the research question posed in advance, how effective the wild boar scare off is in keeping away wild boar, we can already make some statements through the explorative data analysis. Out of the 5 scare off that were finally selected for consideration, 3 showed the opposite effect of what we expected. Namely, an increase in wild boar occurrence during the scare off period. The scare offs WSS_2016_01 and WSS_2016_05, on the other hand, showed after exploratory analysis, the expected pattern in case of an effective defense measure. For this reason, these two scare offs were examined in more detail in a statistical data analysis.

### Confirmatory Analysis
#### ANOVA and Tukey's Post-Hoc Boxplot

An ANOVA revealed a significant difference in wild boar occurrence before, during, and after the scare off event of WSS_2016_01 (p-value =2.91x10-9), considering a 200 m impact radius. However, the difference is between the occurrence before and after the startle event, while there is no significant difference to the occurrence during the scare off event on both sides (Tukey's post-hoc test) (*Figure 11*). 

For WSS_2016_05, no statistically significant effect of the wild boar scare off could be detected, related to the occurrence before, during, and after the event considering an effect radius of 200 m ANOVA, p= 0.602) (*Figure 12*). 

```{r, fig.cap = "Figure 11: Box Plot with Tukey's Post-Hoc Test for scare off WSS_2016_01, number of GPS locations per day within 200 m radius, before, during, and after the scare off event"}
# Run above function for schreck WSS_2016_01
  WSS_2016_01_package <- anova_for_schreck("WSS_2016_01", 200)
  pander(summary(WSS_2016_01_package$anova), caption = "Table 6: Summary of Analysis of Variance Model for scare off WSS_2016_01 (number of GPS locations per day within 200 m radius ~ period in relation to scare off event")
  WSS_2016_01_package$plot
```

```{r, fig.cap = "Figure 12: Box Plot with Tukey's Post-Hoc Test for scare off WSS_2016_05, number of GPS locations per day within 200 m radius, before, during, and after the scare off event"}
# Run above function for schreck WSS_2016_01
  WSS_2016_05_package <- anova_for_schreck("WSS_2016_05", 200)
  pander(summary(WSS_2016_05_package$anova), caption = "Table 7: Summary of Analysis of Variance Model for scare off WSS_2016_05 (number of GPS locations per day within 200 m radius ~ period in relation to scare off event")
  WSS_2016_05_package$plot
```

None of the scare offs shows a significant effect related to the total occurrence of wild boars. Based on this we conclude that the scare offs do not influence the spatial behavior, in terms of location. For this reason, the second part of research question 1, how long the effect lasts, cannot be answered. The investigation of research question 2, what settings (mode, noise level, interval, azimuth) and setting-combinations are most effective at keeping away wild boar, could therefore not be pursued further in a statistical manner.

## Scare Off Parameter Setting (Q2)

*Table 8* shows the summary of parameter settings of the relevant scare offs, including the crop on which they were installed. All scare offs were running during a period of low hunting pressure and no fence was placed. Further, the setting of the scare offs phase was 2 for each. As we could not find a significant effect of the scare offs, modelling the impact depending on the settings is not useful. However, a weighing of the density plots (*Figure 5*) based on the settings is possible. 
WSS_2016_01 and WSS_2016_05 showed both the expected pattern but the parameter settings are different in terms of mode and volume. Taking in consideration the crop species, we assume, that the standard mode in combination with the higher volume was sufficient to defend the meadow and harvesting crops afford tougher defence strategies. Scare offs in 2015 were all installed on wheat (/potato) crops. The mode of WSS_2015_01 and WSS_2015_03 was switched in the mid of June from standard to aggressive and the volume was enhanced as well. That could explain the decrease of the wild boar occurrence in the middle of the scare off events. For WSS_2015_04 no switch of mode was performed, but an increase of volume after the first half of the scare off event, where also a decrease of wild boar occurrence was observed.

```{r}
schreck_parameter <- schreck_agenda_and_locations_filtered[-9:-10,]
schreck_parameter <- subset(schreck_parameter, select = -c(geometry, region, zaun, jagddruck, phase)) %>%
  st_drop_geometry() %>%
  rename(inst_hoehe = installationshohe)
kable(schreck_parameter, caption = "Table 8: Parameter settings of relevant scare offs in the Fanel region")
```

# Discussion

In this work, we set up two research questions that build on each other. To answer them, we first had to filter the data temporally and spatially, taking into account the irregular sampling of wild boar locations on the one hand. On the other hand, the data provided did not include any information on the range of wild boar scare offs, both of which were challenging. We therefore chose to visually estimate the radius studied using exploratory data analysis. For further investigation, a volume in decibels would be helpful to estimate the range considering the hearing ability of wild boars. Furthermore, after filtering and sorting out the scare off events with too short a duration or too few data points, only 5 of the original nearly 70 scare off events remained for consideration. With our goal of having as much useful data as possible, this obviously reduces the statistical power. In the course of this, however, we also found that the scale and resolution of the analysis plays a large role. For example, the behavior of a single wild boar is relatively manageable and easy to interpret, but hardly meaningful for the whole population. On the other hand, pooling all data bears the risk of overlooking individual effects. This is especially true with respect to the scare off events, where we did not initially consider the crop and parameter settings.

To answer the first research question, we compared the scare off periods, showing very different data volumes per scare off event. This in turn affects the statistical comparability in the second step. The 10 day pre- and post-scare off periods tend to represent the immediate impact of the scare offs, and lengthening or restricting these periods may lead to different results. In summary, although there was a visual effect of the scare offs, it was not statistically significant. Thus, based on our data and analysis, we cannot answer the second part of the research question, how long the effect of the scare offs lasts.

Nevertheless, differences in the importance of individual parameters can be seen when comparing the parameter settings, in regard of research question 2. For example, the mode and the volume seem to have an effect on the efficiency. This is especially indicated by the decrease in the occurrence of wild boar after switching the mode and increasing the volume. In the first part of the data analysis, we did not consider switching off mode. In retrospect, it appears to have had an effect. However, our analysis strategy requires a certain amount of time before and after the scare off event to have a basis for comparison as a control, which is not the case with switching mode without interruption. Also, the comparison with a previous year based on these data was not possible, because the wild boars were tracked in irregular intervals. Furthermore, other effects, such as different crops and weather conditions or random behavior of the wild boars could dominate here.  Since no significant effect of the scare off could be detected, we did not consider it useful to generate a statistical model to describe the ability of the wild boars to stay away. Therefore, only statements based on exploratory data analysis are possible.

In conclusion, although our data analysis did not show a significant effect of the scare offs, we were able to show that the scaling influences the results. In a further analysis, it would therefore be useful to distinguish between crops and parameters at the beginning. Furthermore, a better alignment of the data collection of wild boar locations and scare events is advisable in a re-sampling to be able to use the data efficiently.

# References

1. 	Suter Forschungsgruppe Wildtiermanagement WILMA, S. Forschungsprojekt Prävention von Wildschweinschäden in Der Landwirtschaft.
2. 	Thurfjell, H.; Ball, J. P.; Åhlén, P.-A.; Kornacher, P.; Dettki, H.; Sjöberg, K. Habitat Use and Spatial Patterns of Wild Boar Sus Scrofa (L.): Agricultural Fields and Edges. European Journal of Wildlife Research 2009, 55 (5), 517–523. https://doi.org/10.1007/s10344-009-0268-1.
3. 	Geisser, H.; Reyer, H. The Influence of Food and Temperature on Population Density of Wild Boar (Sus Scrofa) in the Thurgau (Switzerland). Journal of Zoology 2005, 267 (1), 89–96. https://doi.org/10.1017/S095283690500734X.
4. 	Geisser, H. Efficacy of Hunting, Feeding, and Fencing to Reduce Crop Damage by Wild Boars. https://doi.org/10.2193/0022-541X.
5. 	Jagdstatistik. https://www.jagdstatistik.ch/de/statistics?tt=2&dt=0&at=0&st=0&dp=0&ar=GE&th=1&yr%5Bfrom%5D=2000&yr%5Bto%5D=2020&sp=350 (accessed 2022-06-22).
6. 	Wildschweinmanagement – Lernen aus der Erfahrung anderer. https://www.admin.ch/gov/de/start/dokumentation/medienmitteilungen.msg-id-8817.html (accessed 2022-06-22).
7. 	Thurfjell, H.; Spong, G.; Ericsson, G. Effects of Hunting on Wild Boar (Sus Scrofa) Behaviour. Wildlife Biology 2013, 19 (1), 87–93. https://doi.org/10.2981/12-027.
8. 	Meynhardt H. Untersuchung Zur Akustischen, Olfaktorischen Und Visuellen Kommunikation Des Europäischen Wildschweines (Sus Scarofa L.). Beiträge für die Frorstwirtschaft 1980, 14 (2), 74–82.
9. 	Laube, P. Representation: Trajectories. In International Encyclopedia of Geography: People, the Earth, Environment and Technology; John Wiley & Sons, Ltd: Oxford, UK, 2017; pp 1–11. https://doi.org/10.1002/9781118786352.wbieg0593.
10. Laube, P. Computational Movement Analysis; Springer International Publishing: Cham, 2014. https://doi.org/10.1007/978-3-319-10268-9.
